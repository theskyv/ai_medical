åŒ»ç–—æ™ºèƒ½åŠ©æ‰‹ç³»ç»Ÿ
é¡¹ç›®ä»‹ç»
ä¸€æ¬¾é›†æˆ åŒ»ç–—çŸ¥è¯†é—®ç­” ä¸ åŒ»é™¢äº‹åŠ¡åŠç†å¼•å¯¼ çš„æ™ºèƒ½åŠ©æ‰‹ç³»ç»Ÿã€‚åŸºäº Neo4j çŸ¥è¯†å›¾è°±å­˜å‚¨åŒ»ç–—é¢†åŸŸæ•°æ®ï¼Œç»“åˆå¤§æ¨¡å‹å®ç°æ„å›¾è¯†åˆ«ä¸è‡ªç„¶è¯­è¨€äº¤äº’ï¼Œå¯ç²¾å‡†åŒºåˆ†ç”¨æˆ·çš„ â€œåŒ»ç–—å’¨è¯¢éœ€æ±‚â€ï¼ˆå¦‚ç–¾ç—…ç—‡çŠ¶ã€ç”¨è¯å»ºè®®ï¼‰ä¸ â€œäº‹åŠ¡åŠç†éœ€æ±‚â€ï¼ˆå¦‚æŒ‚å·ã€æŠ¥å‘ŠæŸ¥è¯¢ï¼‰ï¼Œæä¾›é«˜æ•ˆã€è´´åˆåœºæ™¯çš„å“åº”ã€‚
æ ¸å¿ƒåŠŸèƒ½
åŠŸèƒ½æ¨¡å—	å…·ä½“èƒ½åŠ›
æ„å›¾è¯†åˆ«	è‡ªåŠ¨åˆ†ç±»ç”¨æˆ·éœ€æ±‚ä¸º consultï¼ˆåŒ»ç–—å’¨è¯¢ï¼‰ã€requestï¼ˆäº‹åŠ¡åŠç†ï¼‰ã€unknownï¼ˆæœªçŸ¥éœ€æ±‚ï¼‰
åŒ»ç–—çŸ¥è¯†é—®ç­”	åŸºäº Neo4j çŸ¥è¯†å›¾è°±ï¼Œå›ç­”ç–¾ç—…ã€ç—‡çŠ¶ã€è¯ç‰©ã€æ£€æŸ¥é¡¹ç›®ç­‰åŒ»ç–—ç›¸å…³é—®é¢˜
äº‹åŠ¡åŠç†å¼•å¯¼	é’ˆå¯¹æŒ‚å·ã€æŠ¥å‘ŠæŸ¥è¯¢ã€è´¹ç”¨æ”¯ä»˜ç­‰éœ€æ±‚ï¼Œç›´æ¥å¼•å¯¼è‡³å¯¹åº”åŠŸèƒ½å…¥å£
å®ä½“å¯¹é½ä¼˜åŒ–	é€šè¿‡å‘é‡æ£€ç´¢å®ç°ç”¨æˆ·è¾“å…¥å®ä½“ä¸å›¾è°±æ•°æ®çš„ç²¾å‡†åŒ¹é…ï¼ˆå¦‚ â€œè‚šå­ç–¼â€ å¯¹é½ â€œè…¹ç—›â€ï¼‰
æŠ€æœ¯æ ˆ
åç«¯æ¡†æ¶ï¼šPythonï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
çŸ¥è¯†å›¾è°±ï¼šNeo4jï¼ˆå­˜å‚¨åŒ»ç–—å®ä½“ä¸å…³ç³»ï¼‰
å¤§æ¨¡å‹é›†æˆï¼šDeepSeekï¼ˆæ„å›¾è¯†åˆ«ã€Cypher ç”Ÿæˆã€å›ç­”ç”Ÿæˆï¼‰
å‘é‡æ£€ç´¢ï¼šHuggingFace Embeddingsï¼ˆBAAI/bge-small-zh-v1.5ï¼Œå®ä½“å¯¹é½ï¼‰
LangChain ç»„ä»¶ï¼šLangChain-Coreã€LangChain-Neo4jã€LangChain-DeepSeekï¼ˆæµç¨‹ç¼–æ’ï¼‰
ç¯å¢ƒå‡†å¤‡
1. ä¾èµ–å®‰è£…
åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£…æ‰€éœ€ä¾èµ–ï¼š
bash
# æ¨èä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚ venv æˆ– condaï¼‰
pip install -r requirements.txt
requirements.txt å†…å®¹ï¼ˆç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼‰
txt
langchain==0.2.0
langchain-core==0.2.0
langchain-community==0.2.0
langchain-neo4j==0.1.14
langchain-deepseek==0.1.0
huggingface-hub==0.23.0
transformers==4.41.0
torch==2.3.0
neo4j==5.18.0
python-dotenv==1.0.1
2. é…ç½®æ–‡ä»¶è®¾ç½®
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º configuration.py æ–‡ä»¶ï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹å¹¶ä¿®æ”¹å¯¹åº”å‚æ•°ï¼š
python
è¿è¡Œ
# configuration.py
config = {
    "NEO4J_CONFIG": {
        "uri": "bolt://localhost:7687",  # æ›¿æ¢ä¸ºä½ çš„ Neo4j è¿æ¥åœ°å€
        "auth": ("neo4j", "your-neo4j-password")  # æ›¿æ¢ä¸ºä½ çš„ Neo4j ç”¨æˆ·åä¸å¯†ç 
    },
    "DEEPSEEK_API_KEY": "your-deepseek-api-key"  # æ›¿æ¢ä¸ºä½ çš„ DeepSeek API å¯†é’¥ï¼ˆä»å®˜ç½‘è·å–ï¼‰
}
3. Neo4j å›¾è°±å‡†å¤‡
å¯åŠ¨ Neo4j æœåŠ¡ï¼ˆæœ¬åœ°æˆ–äº‘ç«¯ï¼‰ï¼Œç¡®ä¿èƒ½é€šè¿‡ä¸Šè¿° uri æ­£å¸¸è¿æ¥ã€‚
å¯¼å…¥åŒ»ç–—é¢†åŸŸæ•°æ®è‡³ Neo4jï¼Œéœ€åŒ…å«ä»¥ä¸‹å®ä½“æ ‡ç­¾ï¼š
Causeï¼ˆç—…å› ï¼‰ã€Checkï¼ˆæ£€æŸ¥é¡¹ç›®ï¼‰ã€Departmentï¼ˆç§‘å®¤ï¼‰ã€Diseaseï¼ˆç–¾ç—…ï¼‰
Drugï¼ˆè¯ç‰©ï¼‰ã€Durationï¼ˆæ²»ç–—å‘¨æœŸï¼‰ã€Foodï¼ˆé£Ÿç‰©ï¼‰ã€Peopleï¼ˆæ˜“æ„Ÿäººç¾¤ï¼‰
Symptomï¼ˆç—‡çŠ¶ï¼‰ã€Treatï¼ˆæ²»ç–—æ–¹å¼ï¼‰ã€Wayï¼ˆä¼ æ’­é€”å¾„ï¼‰ã€PreventWayï¼ˆé¢„é˜²æªæ–½ï¼‰
ä¸ºå„å®ä½“åˆ›å»º å‘é‡ç´¢å¼• ä¸ å…¨æ–‡ç´¢å¼•ï¼ˆå‚è€ƒä»£ç ä¸­ _init_neo4j_vectors æ–¹æ³•é€»è¾‘ï¼‰ã€‚
ç³»ç»Ÿå¯åŠ¨
åˆ‡æ¢è‡³é¡¹ç›® src ç›®å½•ï¼ˆè‹¥æ ¸å¿ƒè„šæœ¬ main.py åœ¨ src æ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼š
bash
cd /path/to/your-project/src  # æ›¿æ¢ä¸ºä½ çš„é¡¹ç›® src ç›®å½•å®é™…è·¯å¾„
æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼ŒæŒ‡å®š app åŠ¨ä½œï¼š
bash
python main.py app
å¯åŠ¨æˆåŠŸåï¼Œå¯é€šè¿‡æ¥å£è°ƒç”¨ï¼ˆå¦‚æ‰©å±• Flask/FastAPIï¼‰æˆ–å‘½ä»¤è¡Œæµ‹è¯•äº¤äº’åŠŸèƒ½ã€‚
åŠŸèƒ½æµ‹è¯•
æµ‹è¯•ç”¨ä¾‹å‚è€ƒ
æµ‹è¯•ç±»å‹	ç”¨æˆ·è¾“å…¥ç¤ºä¾‹	é¢„æœŸè¾“å‡ºæ•ˆæœ
äº‹åŠ¡åŠç†ï¼ˆrequestï¼‰	â€œæˆ‘è¦æŒ‚å·â€	â€œè¯·é€šè¿‡ã€æŒ‚å·é¢„çº¦ã€‘åŠŸèƒ½å…¥å£è¿›è¡Œæ“ä½œï¼ˆç‚¹å‡»é¡µé¢å¯¹åº”æŒ‰é’®å³å¯ï¼‰â€
åŒ»ç–—å’¨è¯¢ï¼ˆconsultï¼‰	â€œåƒå®Œé›ªç³•è‚šå­ç–¼æ€ä¹ˆåŠâ€	åŸºäºå›¾è°±è¿”å›åŒ»ç–—å»ºè®®ï¼ˆå¦‚ â€œå¯èƒ½ä¸ºè‚ èƒƒç—‰æŒ›ï¼Œå»ºè®®çƒ­æ•·è…¹éƒ¨ï¼Œé¿å…ç”Ÿå†·é£Ÿç‰©â€ï¼‰
æœªçŸ¥éœ€æ±‚ï¼ˆunknownï¼‰	â€œä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·â€	å¤§æ¨¡å‹å°è¯•å›ç­”ï¼Œæˆ–è¿”å› â€œæš‚æœªæ”¯æŒè¯¥ç±»å‹çš„éœ€æ±‚ï¼Œè¯·å°è¯•å’¨è¯¢åŒ»ç–—ç›¸å…³é—®é¢˜â€
ç³»ç»Ÿé—®é¢˜	â€œä½ æ˜¯è°â€	å¤§æ¨¡å‹è¿”å›è‡ªæˆ‘ä»‹ç»ï¼ˆå¦‚ â€œæˆ‘æ˜¯åŒ»ç–—æ™ºèƒ½åŠ©æ‰‹ï¼Œå¯è§£ç­”åŒ»ç–—é—®é¢˜æˆ–å¼•å¯¼äº‹åŠ¡åŠç†â€ï¼‰
è°ƒè¯•æ—¥å¿—
å¯åŠ¨åç»ˆç«¯ä¼šè¾“å‡ºå…³é”®æµç¨‹æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ï¼š
æ„å›¾åˆ†ç±»ç»“æœï¼šğŸ¯ç”¨æˆ·æ„å›¾åˆ†ç±»ç»“æœ:consult
ç”Ÿæˆçš„ Cypher è¯­å¥ï¼šğŸ‰ç”Ÿæˆçš„æŸ¥è¯¢è¯­å¥:MATCH (d:Disease)-[:has_symptom]->(s:Symptom) WHERE d.name = $param_0 RETURN s.name
å®ä½“å¯¹é½ç»“æœï¼šğŸ’šåŸå®ä½“:è‚šå­ç–¼-->å¯¹é½å®ä½“:è…¹ç—›
æ‰©å±•è¯´æ˜
1. æ–°å¢äº‹åŠ¡åŠŸèƒ½
è‹¥éœ€æ·»åŠ æ–°çš„äº‹åŠ¡ç±»å‹ï¼ˆå¦‚ â€œç–«è‹—é¢„çº¦â€ï¼‰ï¼Œä»…éœ€åœ¨ä»£ç çš„ INTENT_INFO ä¸­è¡¥å……å…³é”®è¯ï¼š
python
è¿è¡Œ
INTENT_INFO = {
    "request": [
        # åŸæœ‰äº‹åŠ¡ï¼ˆå¦‚æŒ‚å·é¢„çº¦ã€æŠ¥å‘ŠæŸ¥è¯¢ç­‰ï¼‰
        "ç–«è‹—é¢„çº¦"  # æ–°å¢äº‹åŠ¡å…³é”®è¯
    ],
    "consult": [
        # åŸæœ‰åŒ»ç–—å’¨è¯¢å…³é”®è¯...
    ]
}
2. ä¼˜åŒ–åŒ»ç–—çŸ¥è¯†
æ‰©å±•å›¾è°±æ•°æ®ï¼šæ–°å¢ç–¾ç—…ã€è¯ç‰©ã€æ£€æŸ¥é¡¹ç›®ç­‰å®ä½“ä¸å…³ç³»ï¼Œä¸°å¯Œé—®ç­”å†…å®¹ã€‚
æ›´æ–°å‘é‡æ¨¡å‹ï¼šæ›¿æ¢ HuggingFaceEmbeddings çš„ model_nameï¼ˆå¦‚ä½¿ç”¨ BAAI/bge-large-zh-v1.5ï¼‰ï¼Œæå‡å®ä½“å¯¹é½ç²¾åº¦ã€‚
3. å‰ç«¯å¯¹æ¥ç¤ºä¾‹
å¯åŸºäº Flask å°è£…æ¥å£ï¼Œæä¾›ç»™å‰ç«¯è°ƒç”¨ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š
python
è¿è¡Œ
# src/api.pyï¼ˆæ–°å¢æ–‡ä»¶ï¼‰
from flask import Flask, request, jsonify
from chat_service import ChatService

app = Flask(__name__)
chat_service = ChatService()

@app.route("/chat", methods=["POST"])
def chat():
    data = request.json
    question = data.get("question")
    if not question:
        return jsonify({"code": 400, "msg": "è¯·è¾“å…¥é—®é¢˜"})
    response = chat_service.chat(question)
    return jsonify({"code": 200, "data": {"answer": response}})

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000, debug=True)
æ³¨æ„äº‹é¡¹
Neo4j æ€§èƒ½ä¼˜åŒ–ï¼šè‹¥å›¾è°±æ•°æ®é‡è¾ƒå¤§ï¼Œå»ºè®®è°ƒæ•´å‘é‡ç´¢å¼•ç»´åº¦ã€å…¨æ–‡ç´¢å¼•æƒé‡ï¼Œæå‡æŸ¥è¯¢é€Ÿåº¦ã€‚
å¯†é’¥å®‰å…¨ç®¡ç†ï¼šä¸è¦å°† DEEPSEEK_API_KEY æˆ– Neo4j å¯†ç ç¡¬ç¼–ç ï¼Œæ¨èä½¿ç”¨ .env æ–‡ä»¶ï¼ˆé…åˆ python-dotenvï¼‰ç®¡ç†ï¼š
env
# .env æ–‡ä»¶ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=your-neo4j-password
DEEPSEEK_API_KEY=your-deepseek-api-key
å¹¶ä¿®æ”¹ configuration.py è¯»å–ç¯å¢ƒå˜é‡ï¼š
python
è¿è¡Œ
from dotenv import load_dotenv
import os

load_dotenv()  # åŠ è½½ .env æ–‡ä»¶

config = {
    "NEO4J_CONFIG": {
        "uri": os.getenv("NEO4J_URI"),
        "auth": (os.getenv("NEO4J_USER"), os.getenv("NEO4J_PASSWORD"))
    },
    "DEEPSEEK_API_KEY": os.getenv("DEEPSEEK_API_KEY")
}
å¤§æ¨¡å‹è°ƒç”¨æˆæœ¬ï¼šDeepSeek API è°ƒç”¨ä¼šäº§ç”Ÿè´¹ç”¨ï¼Œæµ‹è¯•é˜¶æ®µå»ºè®®æ§åˆ¶è°ƒç”¨é¢‘ç‡ï¼Œæˆ–æ›¿æ¢ä¸ºæœ¬åœ°éƒ¨ç½²çš„å¤§æ¨¡å‹ï¼ˆå¦‚ Llama ç³»åˆ—ï¼‰ã€‚
